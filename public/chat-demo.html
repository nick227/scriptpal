<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ScriptPal - Modern Chat Demo</title>
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        .demo-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .demo-header {
            padding: 20px;
            background: linear-gradient(135deg, #4ecdc4, #44a08d);
            color: white;
            text-align: center;
        }
        
        .demo-title {
            margin: 0;
            font-size: 24px;
            font-weight: 600;
        }
        
        .demo-subtitle {
            margin: 8px 0 0 0;
            opacity: 0.9;
            font-size: 14px;
        }
        
        .demo-controls {
            padding: 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }
        
        .demo-btn {
            padding: 8px 16px;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            background: white;
            color: #495057;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s ease;
        }
        
        .demo-btn:hover {
            background: #e9ecef;
            border-color: #adb5bd;
        }
        
        .demo-btn.active {
            background: #4ecdc4;
            color: white;
            border-color: #4ecdc4;
        }
        
        .chatbot-container {
            height: 600px;
        }
        
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            padding: 20px;
        }
        
        .feature-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border: 1px solid #e9ecef;
        }
        
        .feature-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            background: linear-gradient(135deg, #4ecdc4, #44a08d);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
            margin-bottom: 12px;
        }
        
        .feature-title {
            font-size: 16px;
            font-weight: 600;
            margin: 0 0 8px 0;
            color: #212529;
        }
        
        .feature-description {
            font-size: 14px;
            color: #6c757d;
            margin: 0;
            line-height: 1.4;
        }
    </style>
</head>
<body>
    <div class="demo-container">
        <div class="demo-header">
            <h1 class="demo-title">ScriptPal Modern Chat</h1>
            <p class="demo-subtitle">Experience the future of AI-powered script writing assistance</p>
        </div>
        
        <div class="demo-controls">
            <button class="demo-btn active" data-theme="modern">Modern Theme</button>
            <button class="demo-btn" data-theme="classic">Classic Theme</button>
            <button class="demo-btn" data-action="add-message">Add Sample Message</button>
            <button class="demo-btn" data-action="clear-chat">Clear Chat</button>
            <button class="demo-btn" data-action="export-chat">Export Chat</button>
        </div>
        
        <div class="chatbot-container" id="chatbot-container">
            <!-- Chat will be initialized here -->
        </div>
        
        <div class="features-grid">
            <div class="feature-card">
                <div class="feature-icon">
                    <i class="fas fa-palette"></i>
                </div>
                <h3 class="feature-title">Beautiful Design</h3>
                <p class="feature-description">Modern gradient design with smooth animations and responsive layout</p>
            </div>
            
            <div class="feature-card">
                <div class="feature-icon">
                    <i class="fas fa-comments"></i>
                </div>
                <h3 class="feature-title">Rich Messaging</h3>
                <p class="feature-description">Support for text, emojis, file uploads, and voice messages</p>
            </div>
            
            <div class="feature-card">
                <div class="feature-icon">
                    <i class="fas fa-search"></i>
                </div>
                <h3 class="feature-title">Smart Search</h3>
                <p class="feature-description">Search through conversation history with intelligent relevance scoring</p>
            </div>
            
            <div class="feature-card">
                <div class="feature-icon">
                    <i class="fas fa-download"></i>
                </div>
                <h3 class="feature-title">Export Options</h3>
                <p class="feature-description">Export conversations in multiple formats: TXT, JSON, HTML, PDF</p>
            </div>
            
            <div class="feature-card">
                <div class="feature-icon">
                    <i class="fas fa-mobile-alt"></i>
                </div>
                <h3 class="feature-title">Mobile Ready</h3>
                <p class="feature-description">Fully responsive design that works perfectly on all devices</p>
            </div>
            
            <div class="feature-card">
                <div class="feature-icon">
                    <i class="fas fa-universal-access"></i>
                </div>
                <h3 class="feature-title">Accessible</h3>
                <p class="feature-description">Built with accessibility in mind, supporting keyboard navigation and screen readers</p>
            </div>
        </div>
    </div>

    <script type="module">
        import { ModernChatWidget } from './js/widgets/chat/ModernChatWidget.js';
        import { ChatManager } from './js/widgets/chat/ChatManager.js';
        import { EventManager } from './js/core/EventManager.js';
        import { StateManager } from './js/core/StateManager.js';

        class ChatDemo {
            constructor() {
                this.chatWidget = null;
                this.chatManager = null;
                this.eventManager = new EventManager();
                this.stateManager = new StateManager();
                this.messageCount = 0;
                
                this.initializeDemo();
            }

            async initializeDemo() {
                const container = document.getElementById('chatbot-container');
                if (!container) return;

                // Initialize chat widget
                this.chatWidget = new ModernChatWidget(
                    { container },
                    this.stateManager,
                    this.eventManager
                );
                await this.chatWidget.initialize();

                // Initialize chat manager
                this.chatManager = new ChatManager(
                    this.stateManager,
                    this.createMockAPI(),
                    this.eventManager
                );
                await this.chatManager.initialize({
                    container,
                    messagesContainer: this.chatWidget.elements.messagesContainer
                });

                this.eventManager.subscribe('CHAT:REQUEST_SEND', (data) => {
                    if (data && data.message) {
                        this.chatManager.handleSend(data.message);
                    }
                });

                // Setup demo controls
                this.setupDemoControls();

                // Add welcome message
                this.addWelcomeMessage();
            }

            createMockAPI() {
                return {
                    getChatResponse: async (message, context) => {
                        // Simulate AI response delay
                        await new Promise(resolve => setTimeout(resolve, 1000 + Math.random() * 2000));
                        
                        const responses = [
                            "That's a great idea! Let me help you develop that concept further.",
                            "I can see the potential in your script. Here are some suggestions to enhance it...",
                            "Interesting character development! Have you considered adding more backstory?",
                            "The dialogue feels natural. You might want to work on the pacing in the middle act.",
                            "This scene has good tension. Consider adding more visual elements to enhance the atmosphere.",
                            "Your formatting looks good! Remember to keep character names consistent throughout.",
                            "I love the plot twist! It adds great depth to the story.",
                            "The opening is compelling. Make sure to maintain that energy throughout the script."
                        ];
                        
                        return {
                            content: responses[Math.floor(Math.random() * responses.length)],
                            metadata: {
                                confidence: 0.85 + Math.random() * 0.15,
                                processingTime: Math.random() * 2000 + 1000
                            }
                        };
                    }
                };
            }

            setupDemoControls() {
                const controls = document.querySelector('.demo-controls');
                if (!controls) return;

                controls.addEventListener('click', (e) => {
                    const button = e.target.closest('.demo-btn');
                    if (!button) return;

                    const action = button.dataset.action;
                    const theme = button.dataset.theme;

                    if (action) {
                        this.handleDemoAction(action);
                    } else if (theme) {
                        this.switchTheme(theme);
                    }
                });
            }

            handleDemoAction(action) {
                switch (action) {
                    case 'add-message':
                        this.addSampleMessage();
                        break;
                    case 'clear-chat':
                        this.clearChat();
                        break;
                    case 'export-chat':
                        this.exportChat();
                        break;
                }
            }

            switchTheme(theme) {
                const buttons = document.querySelectorAll('.demo-btn[data-theme]');
                buttons.forEach(btn => btn.classList.remove('active'));
                document.querySelector(`[data-theme="${theme}"]`).classList.add('active');

                const container = document.getElementById('chatbot-container');
                if (theme === 'classic') {
                    container.classList.add('classic-theme');
                } else {
                    container.classList.remove('classic-theme');
                }
            }

            addWelcomeMessage() {
                const welcomeMessages = [
                    "Welcome to ScriptPal! I'm your AI writing assistant.",
                    "I can help you with script writing, character development, and story structure.",
                    "Try asking me about your script or share an idea you're working on!",
                    "What would you like to work on today?"
                ];

                welcomeMessages.forEach((message, index) => {
                    setTimeout(() => {
                        this.chatManager.processAndRenderMessage(message, 'assistant');
                    }, index * 1000);
                });
            }

            addSampleMessage() {
                const sampleMessages = [
                    "Help me develop my main character's backstory",
                    "What do you think about this dialogue?",
                    "I need help with the plot structure",
                    "Can you review my script formatting?",
                    "How can I make this scene more dramatic?",
                    "What are some good plot twists for a thriller?",
                    "Help me write better character descriptions",
                    "I'm stuck on the ending, any suggestions?"
                ];

                const message = sampleMessages[Math.floor(Math.random() * sampleMessages.length)];
                this.eventManager.publish('CHAT:REQUEST_SEND', {
                    message: message,
                    timestamp: new Date().toISOString()
                });
            }

            clearChat() {
                this.chatManager.clearChat();
                this.addWelcomeMessage();
            }

            exportChat() {
                alert('Export is not wired in the demo yet.');
            }
        }

        // Initialize demo when page loads
        document.addEventListener('DOMContentLoaded', () => {
            new ChatDemo();
        });
    </script>
</body>
</html>
